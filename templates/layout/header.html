{% load static %}
<script src="{% static 'js/common.js' %}"></script>
<header class="main-header" id="mainHeader">
    <div class="header-left-group">
        {% if request.resolver_match.url_name != 'setting' %}
            <div class="hamburger-menu" onclick="toggleSidebar()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        {% endif %}
        
        <a href="/videos/home" class="logo-link">
            <img src="{% static 'images/BAIS.png' %}" alt="BAIS" class="header-logo">
        </a>
    </div>

    <div class="header-right-group">
        <div class="header-search-wrapper">
            <form action="{% url 'videos:home' %}" method="GET" id="headerSearchForm">
                <input type="text" name="q" class="header-search-input" placeholder="영상 제목, 구단 검색" value="{{ search_query|default:'' }}">
                <button type="button" class="icon-btn search-trigger" onclick="toggleHeaderSearch()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </form>
        </div>

        <button class="icon-btn logout-btn" onclick="location.href='/logout'" title="로그아웃">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        </button>

        <div class="profile-wrapper" onclick="location.href='/setting'">
            <div class="profile-icon">
                {% if request.session.user_id %}    
                    {% if user and user.favorite_code %}
                        <img src="{% static 'images/mascot/' %}{{ user.favorite_code.common_code_value }}.png" 
                             alt="Team Logo" class="user-team-logo" onerror="this.src='{% static 'images/logo.png' %}'">
                    {% else %}
                        <img src="{% static 'images/logo.png' %}" alt="Default Profile">
                    {% endif %}
                {% else %}
                    <img src="{% static 'images/logo.png' %}" alt="Guest Profile">
                {% endif %}
            </div>
            
            {% if request.session.user_id %}
            <div class="profile-tooltip">
                <p>{{ team_full_name }} : {{ team_mascot }}</p>
                <p style="color:#ccc;">{{ user.email }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</header>

<div id="sidebarOverlay" class="bg-overlay" onclick="toggleSidebar()"></div>
<div id="mySidebar" class="sidebar">
    <div class="sidebar-header">
        <span class="closebtn" onclick="toggleSidebar()">&times;</span>
    </div>

    <div class="sidebar-content">
        <div class="sidebar-title-wrapper">
            <div class="sidebar-title" onclick="toggleSidebarLeague()">
                <span id="sidebarLabel">KBO</span>
                <span id="sidebarArrow" style="font-size: 0.8rem;">▼</span>
            </div>

            <div id="sidebarLeagueList" class="sidebar-dropdown-list">
                <div onclick="selectSidebarLeague('KBO')">KBO</div>
                <div onclick="selectSidebarLeague('TEAM_KOREA')">TEAM KOREA</div>
            </div>
        </div>
        
        <div id="team-list-container" class="team-grid-sidebar" data-my-team="{{ current_team_code }}">
            <button class="team-list-btn" onclick="changeTeam(this, 'LG')" data-code="LG">
                <img src="{% static 'images/teams/lg.svg' %}" alt="LG"> LG 트윈스
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'HANWHA')" data-code="HANWHA">
                <img src="{% static 'images/teams/hanwha.svg' %}" alt="Hanwha"> 한화 이글스
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'SSG')" data-code="SSG">
                <img src="{% static 'images/teams/ssg.svg' %}" alt="SSG"> SSG 랜더스
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'SAMSUNG')" data-code="SAMSUNG">
                <img src="{% static 'images/teams/samsung.svg' %}" alt="Samsung"> 삼성 라이온즈
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'NC')" data-code="NC">
                <img src="{% static 'images/teams/nc.svg' %}" alt="NC"> NC 다이노스
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'KT')" data-code="KT">
                <img src="{% static 'images/teams/kt.svg' %}" alt="KT"> KT 위즈
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'LOTTE')" data-code="LOTTE">
                <img src="{% static 'images/teams/lotte.svg' %}" alt="Lotte"> 롯데 자이언츠
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'KIA')" data-code="KIA">
                <img src="{% static 'images/teams/kia.svg' %}" alt="KIA"> KIA 타이거즈
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'DOOSAN')" data-code="DOOSAN">
                <img src="{% static 'images/teams/doosan.svg' %}" alt="Doosan"> 두산 베어스
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'KIWOOM')" data-code="KIWOOM">
                <img src="{% static 'images/teams/kiwoom.svg' %}" alt="Kiwoom"> 키움 히어로즈
            </button>
        </div>
        <div id="team-korea-list-container" class="team-grid-sidebar" style="display: none;" data-my-team="{{ current_team_code }}">
            <button class="team-list-btn" onclick="changeTeam(this, 'K-BASEBALL')" data-code="K-BASEBALL">
                <img src="{% static 'images/teams/K-BASEBALL.svg' %}" alt="K-BASEBALL">
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'ASIAN')" data-code="ASIAN">
                <img src="{% static 'images/teams/ASIAN.svg' %}" alt="ASIAN">
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'OLYMPIC')" data-code="OLYMPIC">
                <img src="{% static 'images/teams/OLYMPIC.svg' %}" alt="OLYMPIC">
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'PREMIER')" data-code="PREMIER">
                <img src="{% static 'images/teams/premier12.svg' %}" alt="PREMIER">
            </button>
            <button class="team-list-btn" onclick="changeTeam(this, 'WBC')" data-code="WBC">
                <img src="{% static 'images/teams/WBC.svg' %}" alt="WBC">
            </button>
        </div>
    </div>
    <div class="sidebar-footer">
        {% if has_history %}
            <button class="watch-my-video-btn" onclick="location.href='{% url 'videos:myvideos' %}'">
                내 영상 시청
            </button>
        {% else %}
            <button class="watch-my-video-btn disabled" disabled style="background-color: #555; cursor: not-allowed; opacity: 0.6;">
                내 영상 시청
            </button>
        {% endif %}
    </div>
</div>